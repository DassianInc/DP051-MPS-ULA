<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Gnt-field-EndDate'>/**
</span>@class Gnt.field.EndDate
@extends Gnt.field.Date

A specialized field for editing the task end date value. This class inherits from the `Ext.form.field.Date` field
and any of its configuration options can be used. You can find this field used in the {@link Gnt.widget.TaskForm}
and in the {@link Gnt.column.StartDate} classes but you can also use it in your own components.
See &quot;Using field standalone&quot; in the documentation of {@link Gnt.field.StartDate}.

This field must be bound to a {@link Gnt.model.Task task} instance, which is used for date value processing
(calendars, holidays etc).

#Task interaction

By default the field instantly applies all changes to the bound task. This can be turned off with the {@link #instantUpdate} option.

#Using field standalone

Please refer to {@link Gnt.field.StartDate} for details.

* **Note**, that the value displayed in the field can be different from the value in the data model when editing milestones
or when the date does not contain any time information (hours/minutes etc). This is because in our component, an end date represents a distinct point
on the timeaxis. For example: if from a user perspective, a task starts at 2013/01/01 and ends at 2013/01/02 -
this means that the task actually ends at 2013/01/02 23:59:59.9999. In the task model we store
2013/01/03 00:00:00, but in the field we show 2013/01/02. See also {@link #adjustMilestones}.

*/
Ext.define('Gnt.field.EndDate', {

    extend              : 'Gnt.field.Date',

    requires            : ['Sch.util.Date'],

    alias               : 'widget.enddatefield',

<span id='Gnt-field-EndDate-property-taskField'>    taskField           : 'endDateField',
</span><span id='Gnt-field-EndDate-property-getTaskValueMethod'>    getTaskValueMethod  : 'getEndDate',
</span><span id='Gnt-field-EndDate-property-setTaskValueMethod'>    setTaskValueMethod  : 'setEndDate',
</span>
<span id='Gnt-field-EndDate-cfg-validateStartDate'>    /**
</span>     * @cfg {Boolean} validateStartDate When set to `true`, the field will validate a &quot;startDate &lt;= endDate&quot; condition and will not allow user to save invalid value.
     * Set it to `false` if you use different validation mechanism.
     */
    validateStartDate   : true,

<span id='Gnt-field-EndDate-cfg-l10n'>    /**
</span>     * @cfg {Object} l10n
     * A object, purposed for the class localization. Contains the following keys/values:

            - endBeforeStartText : 'End date is before start date'
     */

    valueToVisible : function (value, task) {
        task = task || this.task;

        return task.getDisplayEndDate(this.format, this.adjustMilestones, value, true);
    },

<span id='Gnt-field-EndDate-method-visibleToValue'>    visibleToValue : function (value) {
</span>        if (value &amp;&amp; this.task) {

            if (!Ext.Date.formatContainsHourInfo(this.format) &amp;&amp; value - Ext.Date.clearTime(value, true) === 0) {
                // the standard ExtJS date picker will only allow to choose the date, not time
                // we set the time of the selected date to the latest availability hour for that date
                // in case the date has no availbility intervals we use the date itself
                value = this.task.getCalendar().getCalendarDay(value).getAvailabilityEndFor(value) ||
                    Sch.util.Date.add(value, Sch.util.Date.DAY, 1);
            }

        } else {
            value = null;
        }

        return value;
    },


<span id='Gnt-field-EndDate-method-isValidAgainstStartDate'>    isValidAgainstStartDate : function (value) {
</span>        return !this.task || !value || value &gt;= this.task.getStartDate();
    },


<span id='Gnt-field-EndDate-method-getErrors'>    // @OVERRIDE
</span>    getErrors : function (value) {
        var errors = this.callParent(arguments);

        if (errors &amp;&amp; errors.length) {
            return errors;
        }

        if (this.validateStartDate) {
            if (!this.isValidAgainstStartDate( this.rawToValue(value)) ) {
                return [this.L('endBeforeStartText')];
            }
        }

        return [];
    }
});
</pre>
</body>
</html>
