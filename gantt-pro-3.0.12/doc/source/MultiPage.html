<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Gnt-plugin-exporter-MultiPage'>/**
</span> @class Gnt.plugin.exporter.MultiPage
 @extends Sch.plugin.exporter.MultiPage

 This class extracts pages in a vertical and horizontal order.

 The exporterId of this exporter is `multipage`
 */

Ext.define('Gnt.plugin.exporter.MultiPage', {

    extend              : 'Sch.plugin.exporter.MultiPage',

    mixins              : ['Gnt.plugin.exporter.mixin.DependencyPainter'],

<span id='Gnt-plugin-exporter-MultiPage-property-depsTopOffset'>    depsTopOffset       : 0,
</span>
<span id='Gnt-plugin-exporter-MultiPage-property-normalGridOffset'>    normalGridOffset    : 0,
</span>

<span id='Gnt-plugin-exporter-MultiPage-method-collectNormalRow'>    /**
</span>     * @protected
     * Collects the normal grid row and its taskBoxes.
     * @param  {Element} item The normal grid row
     * @param  {Ext.data.Model} recordIndex Index of the record corresponding to the row.
     * @return {Object} Object keeping reference to the cloned row element and its height.
     */
    collectNormalRow : function (item, recordIndex) {
        var me  = this,
            row = me.callParent(arguments);

        me.fillTaskBox(row.record);

        return row;
    },

<span id='Gnt-plugin-exporter-MultiPage-method-setComponent'>    setComponent : function () {
</span>        var me  = this;
        me.callParent(arguments);
        me.initDependencyPainter();
    },

<span id='Gnt-plugin-exporter-MultiPage-method-onRowsCollected'>    onRowsCollected : function () {
</span>        var me  = this;

        me.renderDependencies();

        me.depsTopOffset    = -me.firstExportedRowOffset;
        me.normalGridOffset = 0;

        me.callParent(arguments);
    },

<span id='Gnt-plugin-exporter-MultiPage-method-commitPage'>    commitPage : function (pageData) {
</span>        var me      = this;

        me.callParent(arguments);

        // on next page dependencies will be shifted vertically based on this page height
        me.depsTopOffset -= pageData.rowsHeight;
    },

<span id='Gnt-plugin-exporter-MultiPage-method-startPage'>    startPage : function (pattern, newColumnPage) {
</span>        var me = this;

        me.normalGridOffset = pattern.normalGridOffset;

        if (newColumnPage) {
            me.depsTopOffset    = -me.firstExportedRowOffset;
        }

        me.callParent(arguments);
    },


<span id='Gnt-plugin-exporter-MultiPage-method-buildPageFrame'>    /**
</span>     * @protected
     * Builds a page frame, a DOM-&quot;skeleton&quot; for a future pages.
     * @param  {Number} colIndex Zero based index of page column to build frame for.
     * @param  {Number} offset   Proper normal grid offset for the page column.
     * @return {Ext.dom.Element} Column page frame.
     */
    buildPageFrame : function (colIndex, offset) {
        var me  = this;

        var copy = me.callParent(arguments);

        // remember locked/normal grids visibility
        copy.normalHidden = me.normalGrid.hidden;
        copy.lockedHidden = me.lockedGrid.hidden;

        return copy;
    },


<span id='Gnt-plugin-exporter-MultiPage-method-preparePageToCommit'>    /**
</span>     * @protected
     * Performs last changes to {@link #getCurrentPage the current page} being extracted before it's pushed into {@link #extractedPages} array.
     * This function will add dependencies to the output fragment.
     * @param {Object} [config] Optional configuration object.
     * @return {Ext.dom.Element} element Element holding the page.
     */
    preparePageToCommit : function () {
        var me          = this,
            frag        = me.callParent(arguments),
            depsCt      = frag.select('.sch-dependencyview-ct').first(),
            splitter    = frag.select('.' + Ext.baseCSSPrefix + 'splitter').first(),
            pageFrame   = me.pageFrames[me.columnPageIndex-1],
            get = function (s) {
                var el = frag.select('#' + s).first();
                return el &amp;&amp; el.dom;
            };

        if (splitter) {
            if (pageFrame.lockedHidden) {
                splitter.hide();
            }
            else {
                splitter.setHeight('100%');
            }
        }

        if (!pageFrame.normalHidden) {
            depsCt.dom.innerHTML = me.dependenciesHtml;

            // move the dependencies div to match the position of the dependency lines
            depsCt.applyStyles({
                top : me.depsTopOffset + 'px'
            });

            var normalGrid  = me.normalGrid,
                id          = normalGrid.getView().id;

            var normalView  = get(id);
            if (normalView) {
                var tableWidth = normalGrid.el.down(me.tableSelector).getWidth();

                // hiding dependencies
                normalView.style.width      = tableWidth + 'px';
                // remove scrollbars
                normalView.style.overflow   = 'hidden';
            }

        }

        if (!pageFrame.lockedHidden) {
            var lockedView  = get( me.lockedView.id );

            if (lockedView) {
                // remove scrollbars
                lockedView.style.overflow   = 'hidden';
            }
        }

        return frag;
    }

});
</pre>
</body>
</html>
