<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Gnt-widget-Calendar'>/**
</span>
@class Gnt.widget.Calendar
@extends Ext.picker.Date

{@img gantt/images/widget-calendar.png}

This a very simple subclass of the {@link Ext.picker.Date} which will show holidays and weekends from the provided calendar.
Any non-working time will be shown as disabled dates.

*/
Ext.define('Gnt.widget.Calendar', {
    extend              : 'Ext.picker.Date',

    alias               : 'widget.ganttcalendar',

    requires            : ['Gnt.data.Calendar', 'Sch.util.Date'],

    mixins              : ['Gnt.mixin.Localizable'],

<span id='Gnt-widget-Calendar-cfg-calendar'>    /**
</span>     * @cfg {Gnt.data.Calendar} calendar An instance of the {@link Gnt.data.Calendar} to read the holidays from
     */
    calendar            : null,

<span id='Gnt-widget-Calendar-cfg-startDate'>    /**
</span>     * @cfg {Date} startDate The start date of the range to show holidays for.
     */
    startDate           : null,

<span id='Gnt-widget-Calendar-cfg-endDate'>    /**
</span>     * @cfg {Date} endDate The end date of the range to show holidays for.
     */
    endDate             : null,

<span id='Gnt-widget-Calendar-method-initComponent'>    initComponent : function () {
</span>        if (!this.calendar) {
            Ext.Error.raise('Required attribute &quot;calendar&quot; missing during initialization of `Gnt.widget.Calendar`');
        }

        if (!this.startDate) {
            Ext.Error.raise('Required attribute &quot;startDate&quot; missing during initialization of `Gnt.widget.Calendar`');
        }

        if (!this.endDate) {
            this.endDate = Sch.util.Date.add(this.startDate, Sch.util.Date.MONTH, 1);
        }

        this.setCalendar(this.calendar);

        this.minDate        = this.value = this.startDate;

        this.callParent(arguments);
        
        // this method requires &quot;this.format&quot; presense which, starting from 4.2.1 is initialized in the parent &quot;initComponent&quot;
        this.injectDates();
    },

<span id='Gnt-widget-Calendar-method-injectDates'>    injectDates : function() {
</span>        var me              = this;
        var disabledDates   = me.disabledDates = [];

        Ext.Array.forEach(me.calendar.getHolidaysRanges(me.startDate, me.endDate), function (range) {
            range.forEachDate(function (date) {
                disabledDates.push(Ext.Date.format(date, me.format));
            });
        });

        me.setDisabledDates(disabledDates);
    },

<span id='Gnt-widget-Calendar-method-setCalendar'>    /**
</span>     * Sets the calendar for this calendar picker
     *
     * @param {Gnt.data.Calendar} The calendar
     */
    setCalendar : function (calendar) {
        var listeners = {
            update  : this.injectDates,
            remove  : this.injectDates,
            add     : this.injectDates,
            load    : this.injectDates,
            clear   : this.injectDates,
            scope   : this
        };

        if (this.calendar) {
            this.mun(calendar, listeners);
        }

        this.calendar = calendar;

        if (calendar) {
            this.mon(calendar, listeners);
        }
    }
});
</pre>
</body>
</html>
