<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Gnt-feature-LabelEditor'>/**
</span> * @class Gnt.feature.LabelEditor
 * @protected
 * @extends Ext.Editor
 *
 * Internal class used by the Gantt chart internals allowing inline editing of the task labels.
 */
Ext.define(&quot;Gnt.feature.LabelEditor&quot;, {
    extend : &quot;Ext.Editor&quot;,

<span id='Gnt-feature-LabelEditor-cfg-labelPosition'>    /**
</span>     * @cfg {String} labelPosition Identifies which side of task this editor is used for. Possible values: 'left', 'right', 'top' or 'bottom'.
     * @property
     */
    labelPosition : '',

<span id='Gnt-feature-LabelEditor-property-triggerEvent'>    triggerEvent    : 'dblclick',
</span>
<span id='Gnt-feature-LabelEditor-property-delegate'>    // private, must be supplied
</span>    delegate        : null,

<span id='Gnt-feature-LabelEditor-property-dataIndex'>    // The field name to edit - private, must be supplied
</span>    dataIndex       : null,
<span id='Gnt-feature-LabelEditor-property-shadow'>    shadow          : false,
</span><span id='Gnt-feature-LabelEditor-property-completeOnEnter'>    completeOnEnter : true,
</span><span id='Gnt-feature-LabelEditor-property-cancelOnEsc'>    cancelOnEsc     : true,
</span><span id='Gnt-feature-LabelEditor-property-ignoreNoChange'>    ignoreNoChange  : true,
</span>

<span id='Gnt-feature-LabelEditor-method-constructor'>    constructor     : function (ganttView, config) {
</span>        this.ganttView = ganttView;
        this.ganttView.on('afterrender', this.onGanttRender, this);

        Ext.apply(this, config);

        if (this.labelPosition === 'left') {
            this.alignment = 'r-r';
        } else if (this.labelPosition === 'right') {
            this.alignment = 'l-l';
        }

        this.delegate = '.sch-gantt-label-' + this.labelPosition;

        this.callParent([config]);
    },

<span id='Gnt-feature-LabelEditor-method-edit'>    // Programmatically enter edit mode
</span>    edit : function (record) {

        if (!record.isEditable(this.dataIndex)) {
            return;
        }

        var eventEl = this.ganttView.getElementFromEventRecord(record);

        if (eventEl) {
            var wrap = eventEl.up(this.ganttView.eventWrapSelector);
            var pnl, old;

            this.record = record;

            if (!this.rendered) {
                this.render(this.ganttView.getSecondaryCanvasEl());
            }

            // HACK: Ext grid panel observes focus events handling in the grid element and messes up
            // the focusing in IE, we work around it
            if (Ext.isIE) {
                pnl = this.ganttView.up('panel');
                old = pnl.handleFocusEnter;

                pnl.handleFocusEnter = Ext.emptyFn;
            }

            this.startEdit(wrap.down(this.delegate), this.dataIndex ? record.get(this.dataIndex) : '');

            // HACK continued
            if (Ext.isIE) {
                pnl.handleFocusEnter = old;
            }
        }
    },

<span id='Gnt-feature-LabelEditor-method-onGanttRender'>    onGanttRender : function (ganttView) {
</span>
        if (!this.field.width) {
            this.autoSize = 'width';
        }

        this.on({
            beforestartedit : function (editor, el, value) {
                return ganttView.fireEvent('labeledit_beforestartedit', ganttView, this.record, value, editor);
            },
            beforecomplete  : function (editor, value, original) {
                return ganttView.fireEvent('labeledit_beforecomplete', ganttView, value, original, this.record, editor);
            },
            complete        : function (editor, value, original) {
                this.record.set(this.dataIndex, value);
                ganttView.fireEvent('labeledit_complete', ganttView, value, original, this.record, editor);
            },
            scope           : this
        });

        ganttView.el.on(this.triggerEvent, function (e, t) {
            this.edit(ganttView.resolveTaskRecord(t));
        }, this, {
            delegate : this.delegate
        });
    }
});
</pre>
</body>
</html>
